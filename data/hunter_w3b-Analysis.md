# Analysis - The Wildcat Protoco Contest

![The Wildcat Protocol](data:image/jpeg;base64,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)

## Description overview of The Wildcat Contest

The Wildcat Protocol is an Ethereum mainnet-based system designed for on-chain fixed-rate private credit. It operates through markets, where borrowers create markets for specific assets with predetermined lenders and rates. Borrowers are not required to provide collateral; instead, a reserve ratio is maintained within the market. There are no underwriters, insurance funds, or proxies, making it a hands-off system.

The Wildcat Protocol also allows borrowers to create undercollateralized credit lines with customizable terms. It grants full control over parameters and lender permissions, with additional functionalities possible based on the market's controller. The protocol is hands-off, and once deployed, offers no control or access to user funds.

This protocol is not intended for retail users but targets sophisticated entities seeking on-chain credit without reliance on third parties. Interest rates are structured with base, protocol, and penalty APRs, activated when markets become delinquent. Sanctioned addresses are monitored, and blocked lenders have their balances placed in escrow. The protocol aims to provide flexibility and creative applications while emphasizing trust between borrowers and lenders.

**The key contracts of Wildcat protocol for this Audit are**:

Auditing the key contracts of the Wildcat Protocol is essential to ensure the security of the protocol. Focusing on them first will provide a solid foundation for understanding the protocol's operation and how it manages user assets and stability. Here's why it's important to audit these specific contracts:

- **WildcatMarketController.sol**: This contract is responsible for deploying markets and managing their parameters, including APR and reserve ratio. An audit will identify vulnerabilities that could potentially compromise the security of these parameters and impact the financial stability of the markets.

- **WildcatMarketControllerFactory.sol**: Auditing this contract is important as it deals with deploying controllers and managing protocol fee information. Vulnerabilities in this contract could lead to fee-related issues and impact the economic functionality of the protocol.

**WildcatArchController.sol**: This registry contract plays a central role in the Wildcat Protocol, overseeing borrowers, controllers, and markets. An audit is vital to ensure that this contract is secure and can't be manipulated in ways that would harm the integrity of the protocol.

- **WildcatMarketBase.sol**: As the base contract for Wildcat markets, it serves as a foundational component. Ensuring its security is paramount to safeguard all markets built on top of it.

**WildcatMarketWithdrawals.sol**: This contract handles the withdrawal functionality for Wildcat markets. Auditing is critical to identify potential issues related to user withdrawals.

**WildcatSanctionsSentinel.sol**: Given its role in interfacing with Chainalysis and managing sanctions, this contract's audit is crucial to prevent unauthorized alterations or misuse of sanctions data.

- **WildcatMarketToken.sol**: This contract provides ERC20 functionality for Wildcat markets. Auditing it is important to prevent potential issues related to token transfers and balances within the markets.

- **Other Libraries and Contracts**: The various libraries and utility contracts used throughout the protocol, such as MathUtils, SafeCastLib, FeeMath, StringQuery, and others, need auditing to ensure they perform their intended functions correctly and securely.

## System Overview

### Scope

- **WildcatMarketController.sol**: The contract deploys and manages Wildcat markets within the Wildcat Protocol. It allows borrower-driven lender authorization and market registration. The contract enforces constraints on market parameters and handles interest rate adjustments while ensuring liquidity coverage. It offers functionalities for querying controlled markets and authorized lenders. This contract is crucial for maintaining the protocol's integrity and flexibility.

- **WildcatMarketBase.sol**: WildcatMarketBase.sol is a fundamental component within the Wildcat Protocol for lending markets: It stores essential market parameters, such as protocol fees and borrower addresses. Manages account roles and authorizations for borrowers and lenders. Keeps track of market state, including accrued fees and interest rates.Introduces a unique market-specific token.Facilitates the processing of withdrawal batches and handles pending withdrawals, playing a critical role in the lending protocol.

- **WildcatMarketControllerFactory.sol**: Deploys controllers for lending markets with specific constraints and configurations. It allows the arch-controller owner to set protocol fee configurations and ensures the uniqueness of each controller. This contract facilitates secure controller and market deployments while managing various constraints.

- **WildcatArchController.sol**: This contract serves as a core component for managing lending markets. It allows for the registration and removal of borrowers, controller factories, controllers, and markets while ensuring proper access control and error handling. It uses the OpenZeppelin library for enumerable sets and inherits from the "Ownable" contract for ownership management.

- **WildcatMarketWithdrawals.sol**: It allows users to request and execute withdrawals with proper authorization, and it ensures proportional distribution of available funds. Withdrawals can be processed in batches when they expire, and funds are transferred to users, or to an escrow if an account is sanctioned. The contract efficiently manages liquidity and handles withdrawal transactions while maintaining the security of the lending market.

- **MathUtils.sol**: This library contains functions for precise mathematical operations, including interest rate calculations and rounding. It's designed for ensuring high-precision calculations for assets, rates, and fees.

- **SafeCastLib.sol**: This library provides functions to safely cast unsigned integers to smaller unsigned integer types, preventing overflow errors.

- **FeeMath.sol**: This library provides functions to calculate interest and fees in a market. It includes features like calculating linear interest based on interest rates in bips, applying protocol fees, updating delinquency fees, and scaling factors. handles various fee-related calculations and updates for a financial market, helping maintain accurate financial records and fee assessments.

- **WildcatMarketConfig.sol**: This contract serves as a hub for configuring a market system. It enables users to retrieve essential market information, manage sanctions by blocking accounts for rule violations, and lets external controllers adjust parameters like the maximum total supply, annual interest rates, and reserve ratios.

- **StringQuery.sol**: Converts right-padded bytes32 data to strings. It also queries and retrieves name and symbol information from target contracts. It handles errors in the query process and is designed for interacting with contracts that store string data as right-padded bytes32 values.

- **WildcatMarket.sol**: The WildcatMarket.sol contract is a core component of a market. It enables users to deposit and withdraw assets, borrow funds, and collect fees. It also allows for market closure. Key functions include depositing assets, withdrawing assets, borrowing funds, collecting protocol fees, and closing the market. The contract is equipped with various checks and permissions for different roles, and it interacts with other contracts in the system to manage assets and state. It's a critical part of The Wildcat Protocol

- **MarketState.sol**: The `MarketStateLib` library and `MarketState` struct define key data structures and functions for a market contract. This contract handles the state and functionality of the market. It keeps track of various parameters, including the total supply, pending withdrawals, annual interest rates, and reserve ratios. The library provides functions to calculate liquidity requirements, borrowable assets, and other crucial market-related calculations.

- **WildcatSanctionsSentinel.sol**: Serves as a sentinel for monitoring and managing sanctions within the system. Key functionalities include checking whether an account is sanctioned based on external data, allowing or removing sanctions overrides by borrowers, and creating escrow contracts to manage specific transactions securely.

- **LibStoredInitCode.sol**: This library is designed to facilitate the deployment of contracts with stored initialization code. It contains functions for deploying contracts with stored init code, creating their addresses, and managing their deployment. The library helps simplify and optimize the process of deploying contracts with pre-determined initialization code, including create, create2, and create2WithStoredInitCode functions.

- **FIFOQueue.sol**: It keeps track of a queue's starting and ending points while allowing for efficient operations, provides functions to interact with the queue, including checking if it's empty, getting the first element, accessing elements by index, finding the length of the queue, retrieving all values, adding elements to the end of the queue, and removing elements from the front of the queue.

- **WildcatMarketToken.sol**: This contract is a part of a broader market protocol and extends functionality from WildcatMarketBase.sol. It's an ERC-20 token with standard token operations. Users can check balances, total supply, approve spenders, and perform transfers and transfers from other accounts. The contract ensures normalized balances with interest included. It tracks allowances for spenders and handles token transfers, scaling them according to the current state.

- **Withdrawal.sol**: Manages withdrawal batches in a market. It calculates the amount owed in a batch and assesses available liquidity for pending batches, considering factors like prior withdrawals and accrued fees.

### Privileged Roles

Some privileged roles exercise powers over the Controller contract:

- **Borrower**

```solidity
  modifier onlyBorrower() {
    if (msg.sender != borrower) {
      revert CallerNotBorrower();
    }
    _;
  }
```

- **Controller**

```solidity
  modifier onlyController() {
    if (msg.sender != controller) revert NotController();
    _;
  }
```

- **ArchControllerOwner**

```solidity
  modifier onlyArchControllerOwner() {
    if (msg.sender != archController.owner()) {
      revert CallerNotArchControllerOwner();
    }
    _;
  }
```

- **Factory Controller**

```solidity
  modifier onlyControllerFactory() {
    if (!_controllerFactories.contains(msg.sender)) {
      revert NotControllerFactory();
    }
    _;
  }
```

## Approach Taken-in Evaluating The Wildcat Protocol

Accordingly, I analyzed and audited the subject in the following steps;

1.  **Core Protocol Contract Overview**:

    I focused on thoroughly understanding the codebase and providing recommendations to improve its functionality.
    The main goal was to take a close look at the important contracts and how they work together in the Wildcat Protocol.

    **Main Contracts I Looked At**

                WildcatMarketController.sol
                WildcatMarketBase.sol
                WildcatMarketControllerFactory.sol
                WildcatArchController.sol
                WildcatMarketWithdrawals.sol
                WildcatMarket.sol
                WildcatSanctionsSentinel.sol
                WildcatMarketToken.sol

    I started my analysis by examining the WildcatArchController.sol contract. Begin by understanding how the Arch Controller manages various entities like borrowers, controllers, and markets.

    Then, I turned our attention to the WildcatMarketControllerFactory.sol contract examine how controllers are created and how protocol fee information is managed.

    Then Dive into WildcatMarketController the market deployment process, configurable parameters, and the management of approved lenders and explore the primary contract for Wildcat markets. This is where most of the market-specific logic should reside.

    Then Check the base contract for Wildcat markets to understand the foundational structure of market contracts and Analyze how withdrawal functionality is handled in Wildcat markets, which is a critical aspect of lending platforms. Then went to Investigate how ERC20 functionality is implemented within Wildcat markets, as this deals with the token aspect of the system. Understand how WildcatSanctionsSentinel contract interfaces with Chainalysis, allowing for borrower sanctions overrides and the deployment of escrows.

2.  **Documentation Review**:

    Then went to Review [This Docs](https://wildcat-protocol.gitbook.io/wildcat/overview/introduction) and [whitepaper](https://github.com/wildcat-finance/wildcat-whitepaper/blob/main/whitepaper_v0.2.pdf) for a more detailed and technical explanation of Wildcat protocol.

3.  **Manuel Code Review** In this phase, I initially conducted a line-by-line analysis, following that, I engaged in a comparison mode.

    - **Line by Line Analysis**: Pay close attention to the contract's intended functionality and compare it with its actual behavior on a line-by-line basis.

    - **Comparison Mode**: Compare the implementation of each function with established standards or existing implementations, focusing on the function names to identify any deviations.

## Architecture Description and Diagram

Architecture of the key contracts that are part of the Wildcat protocol:

This diagram illustrates the interaction among the key components of the Wildcat protocol.

![Wildcat-Diagram-overview](https://i.im.ge/2023/10/26/tgXFMP.Screenshot-from-2023-10-26-10-15-22.png)

A controller contains:

- The address the archcontroller permits to deploy vaults (the borrower),
- The mechanism through which borrowers permit their lenders to interact,
- The sanity-check logic for vault deployment parameters, and
- Mechanisms for vault parameter control (e.g. APR adjustment)

#### Core Contracts

- **WildcatArchController**: Registry for borrowers, controller factories, controllers, and markets.
- **WildcatMarketControllerFactory**: Deploys controllers and manages protocol fee information.
- **WildcatMarketController**: Deploys markets and manages configurable parameters (APR, reserve ratio) and maintains approved lenders.
- **WildcatMarketBase**: Base contract for Wildcat markets, containing shared logic.
- **WildcatMarket**: Main contract for Wildcat markets, inheriting from various base contracts.

#### Market-Related Functionality

- **WildcatMarketWithdrawals**: Handles withdrawal functionality for Wildcat markets.
- **WildcatMarketToken**: Implements ERC20 functionality within Wildcat markets.
- **WildcatMarketConfig**: Manages role-based access control and configuration by controllers.

#### Supporting Libraries

- **MathUtils**: Provides generic math functions for calculations.
- **SafeCastLib**: Functions for safe casting between types, especially for unsigned integers.
- **FeeMath**: Calculates interest, protocol fees, and delinquency fees.
- **StringQuery**: Helper functions for querying strings, especially when methods can return strings or bytes32.
- **MarketState**: Defines the market state struct and provides helper functions for calculations.
- **LibStoredInitCode**: Library for deploying contracts using code storage.
- **FIFOQueue**: Implements a first-in-first-out queue for unpaid withdrawal batches.
- **Withdrawal**: Defines withdrawal state struct and associated functionality.
- **BoolUtils**: Helper functions for working with boolean values.
- **Chainalysis**: Includes constants related to the Chainalysis Sanctions List and interfaces for handling sanctions and escrows.

#### Reentrancy Guard and Error Handling

- **ReentrancyGuard**: Implements a reentrancy guard for security.
- **Errors**: Provides helper functions and constants for handling errors and Solidity panic codes.

#### Specialized Contracts

- **WildcatSanctionsSentinel**: Interfaces with Chainalysis, allowing borrowers to override lenders' sanction statuses and deploying escrows.
- **WildcatSanctionsEscrow**: Manages the escrow contract for specific accounts until they are removed from the Chainalysis sanctions list or until the borrower overrides the account's sanction status.

### Architecture Feedback

1. **Function Complexity**: Some functions within the contracts are relatively long and complex. Consider breaking down these functions into smaller, more manageable units to improve code readability and maintainability.

2. **Error Handling**: Implement a more detailed error-handling mechanism. You have custom error types, which is a good practice. However, it would be beneficial to provide more specific error messages to help developers and auditors and include more details in the error messages.

3. **Initcode and CREATE2 Logic**: When discussing the factory, provide a bit more information about what "initcode" and "CREATE2 logic" entail. This could help technically inclined readers better understand how vault deployment works.

4. **Clarify Return Values**: Some functions return values or arrays in contracts, and it would be helpful to clarify what these values represent. For instance, when describing getRegisteredBorrowers in WildcatArchController contract, explain what the array of addresses represents and how it might be useful.

5. **Upgradeability**: Implementing an upgrade mechanism can be crucial for smart contracts. Consider using proxy patterns like OpenZeppelin's Transparent Proxy or creating your custom upgrade mechanism while taking into account data migration and security considerations.

6. **Formal Verification**: Explore formal verification tools like Mythril, Manticore, or Certora to mathematically prove the correctness and security of your smart contract. This is an advanced technique for ensuring the absence of certain vulnerabilities.

7. **Delegated Execution**: Implement delegation patterns like "delegated execution" or "action permissioning" to allow a trusted contract to perform actions on behalf of users. Ensure that these patterns maintain security and user control.

8. **Governance Mechanisms**: Implement advanced on-chain governance mechanisms to enable token holders to vote on key parameters or contract upgrades. This can include quadratic voting or other advanced decision-making models.

## Codebase Quality

Overall, I consider the quality of the Wildcat codebase to be excellent. The code appears to be very mature and well-developed. We have noticed the implementation of various standards adhere to appropriately. Details are explained below:

| Codebase Quality Categories              | Comments                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| ---------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Code Maintainability and Reliability** | The Wildcat Protocol contracts demonstrates good maintainability through modular structure, consistent naming, and efficient use of libraries. It also prioritizes reliability by handling errors, conducting security checks, and using "immutable" variables. However, for enhanced reliability, consider professional security audits and documentation improvements. Regular updates are crucial in the evolving space.                                                                                                                                                                                                                                                 |
| **Code Comments**                        | The Wildcat codebase contains comments that briefly explain the purpose of important code elements, such as data structures, constants, and function modifiers. While these comments offer some clarity, further in-code comments are needed for individual functions and complex logic to enhance code maintainability and comprehension. Although there are some comments, adding more detailed explanations for complex functions, data structures, and key decisions can be helpful to future developers and auditors. Consider following standardized commenting conventions, such as NatSpec.                                                                         |
| **Documentation**                        | The documentation of the Wildcat project is quite comprehensive and detailed, providing a solid overview of how Wildcat is structured and how its various aspects function. However, we have noticed that there is room for additional details, such as diagrams, to gain a deeper understanding of how different contracts interact and the functions they implement. With considerable enthusiasm. We are confident that these diagrams will bring significant value to the protocol as they can be seamlessly integrated into the existing documentation, enriching it and providing a more comprehensive and detailed understanding for users, developers and auditors. |
| **Testing**                              | The audit scope of the contracts to be audited is 90% and it should be aimed to be 100%.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **Code Structure and Formatting**        | The codebase contracts are well-structured and formatted. It inherits from multiple components, adhering for-example The WildcatMarketController contract starts with importing required libraries.It declares structs, including "TemporaryReserveRatio" and "TmpMarketParameterStorage".The contract initializes immutable variables in the constructor.Functions are provided for managing authorized lenders, controlled markets, and market deployments.The contract enforces parameter constraints and handles interest rates and temporary reserve ratio adjustments.                                                                                                |

## Systemic & Centralization Risks

The analysis provided highlights several significant systemic and centralization risks present in the Wildcat protocol. These risks encompass concentration risk in WildcatMarketController, WildcatMarketBase, WildcatMarketToken risk and more, third-party dependency risk, and centralization risks arising from the existence of an “owner” role in specific contracts. However, the documentation lacks clarity on whether this address represents an externally owned account (EOA) or a contract, warranting the need for clarification. Additionally, the absence of fuzzing and invariant tests could also pose risks to the protocol’s security.

Here's an analysis of potential systemic and centralization risks in the provided contracts:

### Systemic Risks:

1. **No having, fuzzing and invariant tests could open the door to future vulnerabilities**.

2. WildcatMarketBase.sol contract relies on the availability of the underlying asset in the protocol. If the protocol doesn't have sufficient liquidity of the underlying asset, it can lead to liquidity problems, and users may not be able to withdraw their assets when needed and The `reserveRatioBips` parameter determines how much of the funds are reserved. An incorrect setting could either lead to too much capital being reserved (which reduces the market's efficiency) or too little being reserved (which could result in insolvency if too many users try to withdraw simultaneously).

3. In WildcatMarketControllerFactory contract allows anyone to deploy a controller and a market. Systemic risk arises if a malicious user deploys a controller with unfavorable parameters (e.g., high delinquency fees, low collateral ratios) that can lead to significant losses for the protocol and the contract calculates controller addresses using the create2 method, which could lead to address collisions if not handled correctly. Address collisions can disrupt the functioning of the protocol.

4. The owner can remove registered controller factories in WildcatArchController.sol contract. Inappropriate removals without proper governance may result in a loss of diversity in controller types and restrict user choice and the contract allows the owner to register borrowers. Mismanagement in borrower registration, such as overlooking eligibility criteria, may lead to increased credit risk in the protocol.

5. If the WildcatMarketWithdrawals sanctions accounts based on external criteria, such as the isSanctioned function from IWildcatSanctionsSentinel, there's a risk of unfairly blocking user accounts. Inaccurate or arbitrary sanctions could lead to disputes and impact the protocol's reputation and If the protocol's assets are not managed effectively, there is a risk of liquidity shortages. When a withdrawal batch is processed, insufficient funds to cover all pending withdrawals could disrupt the protocol's operation.

6. The updateAccountAuthorization function allows for updates to an account's authorization status in WildcatMarketConfig.sol contract. If not correctly implemented or securely controlled, this could result in accounts gaining unauthorized access or losing access to the market, leading to potential financial risks.

7. WildcatMarket has a closeMarket function that allows the market to be closed. If the market is not fully collateralized, it transfers the remaining debts from the borrower. However, closing the market abruptly could lead to systemic risks if it affects the stability and functioning of the protocol or if there are unpaid withdrawal batches and the contract does not allow the market to be closed if there are unpaid withdrawal batches. Unpaid withdrawal batches can accumulate over time and pose systemic risks as they may represent unfulfilled obligations that can affect market liquidity and user trust.

8. The createEscrow function in WildcatSanctionsSentinel contract checks if the caller (market contract) is a registered market in the archController. If the caller is not a registered market, it reverts. This dependency on the archController introduces systemic risks, especially if the controller is unreliable, centralized, or experiences failures.

### Centralization Risks:

1. The WildcatMarketController.sol contract maintains a list of controlled markets via `_controlledMarkets`. The addition or removal of markets is centralized, as it relies on the controller contract. This centralization could result in governance concerns and may not be fully decentralized and the contract allows the borrower to specify the fee recipient for a newly deployed market. This introduces centralization as the borrower can direct fees to specific addresses.

2. The WildcatMarketBase relies on the sentinel address for blacklisting and other control measures. A compromised or malicious sentinel address could result in undesirable consequences, such as assets being wrongly blocked.

3. WildcatMarketControllerFactory contract does not have a mechanism for updating the ArchController, which could be an issue if there are unforeseen issues with the deployed controllers, as changing the ArchController is not supported.

4. Only the owner can register controller factories in WildcatArchController.sol contract, which can be restrictive and limit the diversity of controllers in the protocol. A more open and decentralized registration process would be preferable.

5. WildcatMarket.sol allows the controller to dynamically adjust parameters such as the annual interest rate and reserve ratio. While flexibility can be beneficial, excessive centralization in making these decisions could lead to unexpected risks.

**Properly managing these risks and implementing best practices in security and decentralization will contribute to the sustainability and long-term success of the Wildcat protocol.**

## Conclusion

In general, the Wildcat project exhibits an interesting and well-developed architecture we believe the team has done a good job
regarding the code, but the identified risks need to be addressed, and measures should be implemented to protect the protocol from
potential malicious use cases. Additionally, it is recommended to improve the documentation and comments in the code to enhance
understanding and collaboration among developers. It is also highly recommended that the team continues to invest in security
measures such as mitigation reviews, audits, and bug bounty programs to maintain the security and reliability of the project.


### Time spent:
20 hours